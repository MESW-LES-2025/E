{"version":3,"sources":["turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/module.compiled.js","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-server-dom-turbopack-client.ts","turbopack:///[project]/lib/profiles.ts","turbopack:///[project]/lib/notifications.ts","turbopack:///[project]/components/Navbar.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactServerDOMTurbopackClient\n","import { fetchWithAuth } from \"./auth\";\n\nconst API_BASE =\n  process.env.NEXT_PUBLIC_API_BASE_URL || \"http://localhost:8000/api\";\n\nexport type ProfileRole = \"ATTENDEE\" | \"ORGANIZER\" | \"ADMIN\";\n\nexport interface Profile {\n  id: number;\n  user_id: number;\n  username: string;\n  email: string;\n  first_name: string;\n  last_name: string;\n  role: ProfileRole;\n  phone_number: string;\n  bio: string;\n  participating_events: number[];\n}\n\nexport interface UpdateProfilePayload {\n  phone_number?: string;\n  bio?: string;\n}\n\nexport async function getProfile(): Promise<Profile> {\n  const response = await fetchWithAuth(`${API_BASE}/accounts/profile/me/`, {\n    method: \"GET\",\n  });\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => ({}));\n    const errorMessage = error?.detail || \"Failed to fetch profile\";\n\n    // If it's an authentication error, provide a clearer message\n    if (response.status === 401 || response.status === 403) {\n      throw new Error(\"Session expired. Please log in again.\");\n    }\n\n    throw new Error(errorMessage);\n  }\n\n  return response.json();\n}\n\nexport async function updateProfile(\n  payload: UpdateProfilePayload,\n): Promise<Profile> {\n  const response = await fetchWithAuth(`${API_BASE}/accounts/profile/me/`, {\n    method: \"PATCH\",\n    body: JSON.stringify(payload),\n  });\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => ({}));\n    throw new Error(error?.detail || \"Failed to update profile\");\n  }\n\n  return response.json();\n}\n","import { fetchWithAuth } from \"./auth\";\n\nconst API_BASE = process.env.NEXT_PUBLIC_API_BASE_URL || \"\";\n\nexport type NotificationItem = {\n  id: number;\n  title: string;\n  message: string;\n  is_read: boolean;\n  created_at: string;\n};\n\nexport async function getUnreadCount(): Promise<number> {\n  const res = await fetchWithAuth(`${API_BASE}/notifications/unread-count/`, {\n    method: \"GET\",\n  });\n  if (!res.ok) throw new Error(\"Failed to fetch unread count\");\n  const data = await res.json();\n  return data.unread ?? 0;\n}\n\nexport async function listNotifications(): Promise<NotificationItem[]> {\n  const res = await fetchWithAuth(`${API_BASE}/notifications/`, {\n    method: \"GET\",\n  });\n  if (!res.ok) throw new Error(\"Failed to fetch notifications\");\n  const data = await res.json();\n  return Array.isArray(data) ? data : (data.results ?? []);\n}\n\nexport async function markAsRead(id: number): Promise<void> {\n  const res = await fetchWithAuth(\n    `${API_BASE}/notifications/${id}/mark-as-read/`,\n    {\n      method: \"POST\",\n    },\n  );\n  if (!res.ok) throw new Error(\"Failed to mark as read\");\n}\n\nexport async function markAsUnread(id: number): Promise<void> {\n  const res = await fetchWithAuth(\n    `${API_BASE}/notifications/${id}/mark-as-unread/`,\n    {\n      method: \"POST\",\n    },\n  );\n  if (!res.ok) throw new Error(\"Failed to mark as unread\");\n}\n\nexport async function markAllAsRead(): Promise<number> {\n  const res = await fetchWithAuth(\n    `${API_BASE}/notifications/mark-all-as-read/`,\n    {\n      method: \"POST\",\n    },\n  );\n  if (!res.ok) throw new Error(\"Failed to mark all as read\");\n  const data = await res.json();\n  return data.updated ?? 0;\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter, usePathname } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { isAuthenticated, logout } from \"@/lib/auth\";\nimport { getProfile, type Profile } from \"@/lib/profiles\";\nimport { Button } from \"@/components/ui/button\";\nimport { getUnreadCount } from \"@/lib/notifications\";\n\nexport default function Navbar() {\n  const router = useRouter();\n  const pathname = usePathname();\n  const [authed, setAuthed] = useState(false);\n  const [profile, setProfile] = useState<Profile | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [unread, setUnread] = useState<number>(0);\n\n  useEffect(() => {\n    const checkAuth = async () => {\n      // First check if user is authenticated before making any API calls\n      const isAuth = isAuthenticated();\n      setAuthed(isAuth);\n\n      // Only fetch profile if user is authenticated\n      if (isAuth) {\n        try {\n          const profileData = await getProfile();\n          setProfile(profileData);\n        } catch (err) {\n          console.error(\"Failed to load profile:\", err);\n          // If profile fetch fails (token expired/invalid), clear auth state\n          const errorMessage = err instanceof Error ? err.message : \"\";\n          if (\n            errorMessage.includes(\"token\") ||\n            errorMessage.includes(\"not valid\") ||\n            errorMessage.includes(\"authentication\") ||\n            errorMessage.includes(\"Session expired\")\n          ) {\n            // Token is invalid, clear it and redirect to login\n            logout();\n            setAuthed(false);\n            setProfile(null);\n            // Only redirect if not already on login page\n            if (pathname !== \"/profile/login\") {\n              router.push(\"/profile/login\");\n            }\n          } else {\n            // Other error, just don't set profile\n            setAuthed(false);\n          }\n        }\n\n        // Fetch unread notifications count\n        try {\n          const count = await getUnreadCount();\n          setUnread(count);\n        } catch {\n          setUnread(0);\n        }\n      } else {\n        // User is not authenticated, ensure profile is null\n        setProfile(null);\n        setUnread(0);\n      }\n\n      setLoading(false);\n    };\n\n    checkAuth();\n  }, [pathname, router]); // Re-check when route changes\n\n  const handleLogout = () => {\n    logout();\n    setAuthed(false);\n    setProfile(null);\n    setUnread(0);\n    router.push(\"/profile/login\");\n  };\n\n  const isOrganizer = profile?.role === \"ORGANIZER\";\n\n  return (\n    <header className=\"bg-white shadow p-4 flex justify-between items-center\">\n      <Link href=\"/\">\n        <h1 className=\"text-2xl font-bold cursor-pointer\">Erasmus in Porto</h1>\n      </Link>\n      <nav className=\"flex gap-4\">\n        <Link href=\"/\">\n          <Button variant=\"ghost\">Home</Button>\n        </Link>\n\n        {loading ? (\n          <Button variant=\"ghost\" disabled>\n            Loading...\n          </Button>\n        ) : authed ? (\n          <>\n            <Link href=\"/calendar\">\n              <Button variant=\"ghost\">Calendar</Button>\n            </Link>\n\n            {isOrganizer && (\n              <Link href=\"/organizations/my\">\n                <Button variant=\"ghost\">My Organizations</Button>\n              </Link>\n            )}\n\n            <Link href=\"/events/my\">\n              <Button variant=\"ghost\">My Events</Button>\n            </Link>\n\n            <Link href=\"/profile\">\n              <Button variant=\"ghost\">My Profile</Button>\n            </Link>\n\n            <Link href=\"/notifications\" className=\"relative\">\n              <Button variant=\"ghost\" className=\"relative\">\n                {/* Simple bell glyph */}\n                <span className=\"mr-2\">ðŸ””</span>\n                Notifications\n                {unread > 0 && (\n                  <span className=\"absolute -top-2 -right-2 bg-red-600 text-white text-xs rounded-full px-2 py-0.5\">\n                    {unread}\n                  </span>\n                )}\n              </Button>\n            </Link>\n\n            <Button variant=\"ghost\" onClick={handleLogout}>\n              Logout\n            </Button>\n          </>\n        ) : (\n          <>\n            <Link href=\"/calendar\">\n              <Button variant=\"ghost\">Calendar</Button>\n            </Link>\n            <Link href=\"/profile/register\">\n              <Button variant=\"ghost\">Register</Button>\n            </Link>\n            <Link href=\"/profile/login\">\n              <Button variant=\"ghost\">Sign In</Button>\n            </Link>\n          </>\n        )}\n      </nav>\n    </header>\n  );\n}\n"],"names":["module","exports","require","vendored","AppRouterContext","HooksClientContext","ServerInsertedHtml","process","env","NEXT_RUNTIME","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","ReactJsxRuntime","React","ReactServerDOMTurbopackClient"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6]}